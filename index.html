<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Portfolio</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css"> </head>
<body>
    <div class="main-content" id="mainContent">

        <div class="empty-state-container" id="emptyState">
            <div class="empty-state-image">
                ✨
            </div>
            <div class="empty-state-text">No transactions yet</div>
            <button class="add-transaction-button" id="addTransactionButtonEmpty">
                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 4V20M4 12H20" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <span>Add transaction</span>
            </button>
        </div>

        <div class="portfolio-content" id="portfolioContent" style="display: none;">
            <div class="portfolio-overview">
                <div class="total-label">Total Portfolio Value</div>
                <div class="total-value" id="totalPortfolioValue">$0.00</div>
                <div class="profit-loss" id="portfolioProfitLoss">+0.00% ($0.00)</div>
            </div>

            <button class="add-transaction-button" id="addTransactionButtonFilled">
                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 4V20M4 12H20" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <span>Add transaction</span>
            </button>

            <div class="token-list" id="tokenList">
                </div>
        </div>

    </div>

    <div class="bottom-navigation">
        <div class="nav-item active" id="navHome">
            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M3 10V18C3 18.5304 3.21071 19.0391 3.58579 19.4142C3.96086 19.7893 4.46957 20 5 20H19C19.5304 20 20.0391 19.7893 20.4142 19.4142C20.7893 19.0391 21 18.5304 21 18V10M12 2L2 12H22L12 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <span>Home</span>
        </div>
        <div class="nav-item inactive" id="navSettings">
            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2ZM15.94 17.65L14.73 16.44C13.88 17.15 12.8 17.58 11.66 17.58C9.52 17.58 7.79 15.86 7.79 13.72C7.79 11.58 9.52 9.85 11.66 9.85C13.8 9.85 15.53 11.58 15.53 13.72C15.53 14.86 15.11 15.94 14.4 16.79L15.61 18C16.82 16.59 17.53 14.7 17.53 12.7C17.53 9.4 15.06 6.7 11.66 6.7C8.26 6.7 5.79 9.4 5.79 12.7C5.79 16 8.26 18.7 11.66 18.7C13.66 18.7 15.55 17.99 16.96 16.78L17.57 17.39L15.94 17.65Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <span>Settings</span>
        </div>
    </div>

    <script>
        // Имитация данных портфеля (теперь mutable, чтобы можно было удалять)
        let MOCK_PORTFOLIO_DATA = [
            {
                id: 'btc-001', // Добавим ID для уникальной идентификации
                name: "Bitcoin",
                ticker: "BTC",
                icon: "₿",
                quantity: 0.15,
                avgBuyPrice: 68000,
                currentPrice: 70500
            },
            {
                id: 'eth-002',
                name: "Ethereum",
                ticker: "ETH",
                icon: "Ξ",
                quantity: 1.2,
                avgBuyPrice: 3500,
                currentPrice: 3800
            },
            {
                id: 'sol-003',
                name: "Solana",
                ticker: "SOL",
                icon: "◎",
                quantity: 15.5,
                avgBuyPrice: 150,
                currentPrice: 140
            },
            {
                id: 'xrp-004',
                name: "Ripple",
                ticker: "XRP",
                icon: "XRP",
                quantity: 1000,
                avgBuyPrice: 0.5,
                currentPrice: 0.52
            }
        ];

        // Флаг для режима редактирования (показывать/скрывать кнопки удаления)
        let isEditingMode = false;

        // Функция для форматирования чисел (для денег и процентов)
        function formatCurrency(value) {
            return `$${value.toFixed(2)}`;
        }

        function formatPercentage(value) {
            return `${value.toFixed(2)}%`;
        }

        // Функция для расчета и обновления портфеля
        function updatePortfolio(portfolioData) {
            const emptyState = document.getElementById('emptyState');
            const portfolioContent = document.getElementById('portfolioContent');
            const tokenList = document.getElementById('tokenList');
            const totalPortfolioValueElement = document.getElementById('totalPortfolioValue');
            const portfolioProfitLossElement = document.getElementById('portfolioProfitLoss');

            if (!portfolioData || portfolioData.length === 0) {
                emptyState.style.display = 'flex';
                portfolioContent.style.display = 'none';
                isEditingMode = false; // Выключаем режим редактирования, если нет транзакций
            } else {
                emptyState.style.display = 'none';
                portfolioContent.style.display = 'flex';

                let totalValue = 0;
                let totalInvested = 0;
                tokenList.innerHTML = ''; // Очищаем список перед заполнением

                portfolioData.forEach(token => {
                    const currentValue = token.quantity * token.currentPrice;
                    const investedValue = token.quantity * token.avgBuyPrice;
                    const profitLossAbsolute = currentValue - investedValue;
                    // Избегаем деления на ноль, если investedValue равно 0
                    const profitLossPercentage = investedValue !== 0 ? (profitLossAbsolute / investedValue) * 100 : 0;

                    totalValue += currentValue;
                    totalInvested += investedValue;

                    const profitLossClass = profitLossAbsolute >= 0 ? 'positive' : 'negative';
                    const profitLossSign = profitLossAbsolute >= 0 ? '+' : '';

                    const tokenCard = `
                        <div class="token-card ${isEditingMode ? 'editing' : ''}" data-id="${token.id}">
                            <div class="token-info-left">
                                <div class="token-icon">${token.icon}</div>
                                <div class="token-details">
                                    <div class="token-name">${token.name}</div>
                                    <div class="token-quantity-ticker">${token.quantity} ${token.ticker}</div>
                                </div>
                            </div>
                            <div class="token-info-right">
                                <div class="token-current-value">${formatCurrency(currentValue)}</div>
                                <div class="token-profit-loss ${profitLossClass}">
                                    ${profitLossSign}${formatPercentage(profitLossPercentage)}
                                </div>
                            </div>
                            <button class="delete-token-btn" data-id="${token.id}">
                                &times;
                            </button>
                        </div>
                    `;
                    tokenList.insertAdjacentHTML('beforeend', tokenCard);
                });

                const totalProfitLossAbsolute = totalValue - totalInvested;
                // Избегаем деления на ноль, если totalInvested равно 0
                const totalProfitLossPercentage = totalInvested !== 0 ? (totalProfitLossAbsolute / totalInvested) * 100 : 0;
                const totalProfitLossClass = totalProfitLossAbsolute >= 0 ? 'positive' : 'negative';
                const totalProfitLossSign = totalProfitLossAbsolute >= 0 ? '+' : '';

                totalPortfolioValueElement.textContent = formatCurrency(totalValue);
                portfolioProfitLossElement.innerHTML = `${totalProfitLossSign}${formatCurrency(totalProfitLossAbsolute)} <span class="${totalProfitLossClass}">(${totalProfitLossSign}${formatPercentage(totalProfitLossPercentage)})</span>`;
            }
            addDeleteListeners(); // Добавляем слушателей после обновления DOM
        }

        // Функция для добавления слушателей на кнопки удаления
        function addDeleteListeners() {
            // Удаляем предыдущие слушатели, чтобы избежать дублирования при каждом вызове updatePortfolio
            document.querySelectorAll('.delete-token-btn').forEach(button => {
                const newButton = button.cloneNode(true);
                button.parentNode.replaceChild(newButton, button); // Заменяем элемент, чтобы сбросить слушатели
            });

            // Добавляем новые слушатели
            document.querySelectorAll('.delete-token-btn').forEach(button => {
                button.addEventListener('click', (event) => {
                    const idToDelete = event.target.dataset.id;
                    if (confirm('Are you sure you want to delete this transaction?')) {
                        MOCK_PORTFOLIO_DATA = MOCK_PORTFOLIO_DATA.filter(token => token.id !== idToDelete);
                        updatePortfolio(MOCK_PORTFOLIO_DATA);
                    }
                });
            });
        }

        // Инициализация портфеля при загрузке
        updatePortfolio(MOCK_PORTFOLIO_DATA); // Запускаем с моковыми данными

        // Обработчики событий
        const addTransactionButtonEmpty = document.getElementById('addTransactionButtonEmpty');
        const addTransactionButtonFilled = document.getElementById('addTransactionButtonFilled');
        const navHome = document.getElementById('navHome');
        const navSettings = document.getElementById('navSettings');

        addTransactionButtonEmpty.addEventListener('click', () => {
            // В реальном приложении здесь будет открытие формы добавления транзакции
            alert('Opening "Add transaction" form from empty state!');
            // Для демонстрации, просто заполняем портфель
            if (MOCK_PORTFOLIO_DATA.length === 0) { // Если пустой, добавляем моковые данные
                MOCK_PORTFOLIO_DATA = [
                    { id: 'btc-001', name: "Bitcoin", ticker: "BTC", icon: "₿", quantity: 0.15, avgBuyPrice: 68000, currentPrice: 70500 },
                    { id: 'eth-002', name: "Ethereum", ticker: "ETH", icon: "Ξ", quantity: 1.2, avgBuyPrice: 3500, currentPrice: 3800 }
                ];
            } else { // Иначе, можно добавить новую транзакцию (пример)
                MOCK_PORTFOLIO_DATA.push({
                    id: `new-${Date.now()}`,
                    name: "Cardano",
                    ticker: "ADA",
                    icon: "A",
                    quantity: 500,
                    avgBuyPrice: 0.45,
                    currentPrice: 0.5
                });
            }
            updatePortfolio(MOCK_PORTFOLIO_DATA);
        });

        addTransactionButtonFilled.addEventListener('click', () => {
            alert('Opening "Add transaction" form from filled state!');
            // То же самое, что и для пустой кнопки - в реале будет форма
            MOCK_PORTFOLIO_DATA.push({
                id: `new-${Date.now()}`,
                name: "Litecoin",
                ticker: "LTC",
                icon: "Ł",
                quantity: 5,
                avgBuyPrice: 70,
                currentPrice: 75
            });
            updatePortfolio(MOCK_PORTFOLIO_DATA);
        });

        navHome.addEventListener('click', () => {
            navHome.classList.add('active');
            navHome.classList.remove('inactive');
            navSettings.classList.add('inactive');
            navSettings.classList.remove('active');
            isEditingMode = false; // Выключаем режим редактирования при переходе на Home
            updatePortfolio(MOCK_PORTFOLIO_DATA); // Обновляем, чтобы скрыть кнопки удаления
        });

        navSettings.addEventListener('click', () => {
            navSettings.classList.add('active');
            navSettings.classList.remove('inactive');
            navHome.classList.add('inactive');
            navHome.classList.remove('active');
            isEditingMode = !isEditingMode; // Переключаем режим редактирования
            alert(`Settings clicked! Editing mode: ${isEditingMode ? 'ON' : 'OFF'}. Click again to toggle.`);
            updatePortfolio(MOCK_PORTFOLIO_DATA); // Обновляем, чтобы показать/скрыть кнопки удаления
        });

    </script>
</body>
</html>
